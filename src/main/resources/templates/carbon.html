<!DOCTYPE html>
<html xmlns:th="http://www.thymeleaf.org">
<head>
    <title>Carbon Emission Calculator</title>
    <script src="https://code.jquery.com/jquery-3.6.0.min.js"></script>
</head>
<body>
<h1>Calculate Carbon Emissions</h1>

<label for="vehicle">Vehicle : </label>
<select id="vehicle" name="vehicle" required>
    <option value="car">Car</option>
    <option value="bus">Bus</option>
    <option value="train">Train</option>
    <option value="plane">Plane</option>
</select>
<br><br>

<div id="carForms" style="display:none;">
    <form id="yearForm" action="/getMakes" method="get">
        <label for="year">Enter Year:</label>
        <input type="text" id="year" name="year" required>
        <button type="submit">Get Makes</button>
    </form>
    <br><br>

    <form id="makeForm" action="/getModels" method="get">
        <label for="make">Select Make:</label>
        <select id="make" name="make" required>
            <option value="">-- Choose a Make --</option>
        </select>
        <button type="submit">Get Models</button>
    </form>
    <br><br>

    <form id="modelForm" action="/getFuelSize" method="get">
        <label for="model">Select Model:</label>
        <select id="model" name="model" required>
            <option value="">-- Choose a Model --</option>
        </select>
        <button type="submit">Get Tank Size</button>
    </form>
    <br><br>

    <form id="tankForm" action="/getFuelInfo" method="get">
        <label for="tank">Select Tank Size:</label>
        <select id="tank" name="tank" required>
            <option value="">-- Choose a Tank Size --</option>
        </select>
        <button type="submit">Submit</button>
    </form>
    <br><br>
</div>

<div id="busForms" style="display:none;">
    <form id="busForm" action="/getBusInfo" method="get">
        <label for="bus">Select Bus Type:</label>
        <select id="bus" name="bus" required>
            <option value="mini_bus"> Mini Bus </option>
            <option value="camper_van"> Camper Van </option>
            <option value="coach"> Coach </option>
            <option value="double_decker"> Double Decker Bus </option>
        </select>
        <button type="submit">Submit</button>
    </form>
</div>

<form action="/calculateCarbon" method="get">
    <label for="origin">Origin :</label>
    <input type="text" id="origin" name="origin" required>
    <br><br>

    <label for="destination">Destination :</label>
    <input type="text" id="destination" name="destination" required>
    <br><br>

    <label for="mode">Mode of Transport:</label>
    <select id="mode" name="mode" required>
        <option value="driving">Driving</option>
        <option value="transit">Public Transport</option>
    </select>
    <br><br>

    <button type="submit">Calculate</button>
</form>

<div th:if="${carbonEmissions != null}">
    <h2>Carbon Emission Results</h2>
    <p>Distance Traveled: <strong th:text="${distance}"></strong> km</p>
    <p>Fuel Type: <strong th:text="${vehicleFuel}"></strong></p>
    <p>Fuel Consumption: <strong th:text="${consumption}"></strong> L/100km or kWh/100km </p>
    <p>Carbon Emissions: <strong th:text="${carbonEmissions}"></strong> kg CO<sub>2</sub></p>
</div>

<script>
    $('#vehicle').on('change', function() {
        var selectedVehicle = $(this).val();

        if (selectedVehicle === 'car') {
            $('#carForms').show();
        } else if (selectedVehicle === 'bus') {
            $('#busForms').show();
        }else{
            $('#carForms').hide();
        }
    });

    $('#yearForm').on('submit', function(e) {
        e.preventDefault();
        var year = $('#year').val();
        $.get('/getMakes', { year: year }, function(data) {
            $('#make').html('');
            $('#make').append('<option value="">-- Choose a Make --</option>');
            data.forEach(function(make) {
                $('#make').append('<option value="' + make + '">' + make + '</option>');
            });
        });
    });

    $('#makeForm').on('submit', function(e) {
        e.preventDefault();
        var year = $('#yearHidden').val();
        var make = $('#make').val();
        $.get('/getModels', { year: year, make: make }, function(data) {
            $('#model').html('');
            $('#model').append('<option value="">-- Choose a Model --</option>');
            data.forEach(function(model) {
                $('#model').append('<option value="' + model + '">' + model + '</option>');
            });
        });
    });

    $('#modelForm').on('submit', function(e) {
        e.preventDefault();
        var year = $('#year').val();
        var make = $('#make').val();
        var model = $('#model').val();

        $.get('/getFuelSize', { year: year, make: make, model: model }, function(data) {
            $('#tank').html('');
            $('#tank').append('<option value="">-- Choose a Tank Size --</option>');

            $.each(data, function(label, value) {
                $('#tank').append('<option value="' + value + '">' + label + '</option>');
            });
        });
    });
</script>
</body>
</html>
